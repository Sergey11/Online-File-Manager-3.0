/**
 * jquery.Jcrop.js v0.9.12
 * jQuery Image Cropping Plugin - released under MIT License 
 * Author: Kelly Hallman <khallman@gmail.com>
 * http://github.com/tapmodo/Jcrop
 * Copyright (c) 2008-2013 Tapmodo Interactive LLC {{{
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * }}}
 */
!function(t){t.Jcrop=function(e,i){function n(t){return Math.round(t)+"px"}function s(t){return F.baseClass+"-"+t}function o(){return t.fx.step.hasOwnProperty("backgroundColor")}function r(e){var i=t(e).offset();return[i.left,i.top]}function a(t){return[t.pageX-z[0],t.pageY-z[1]]}function l(e){"object"!=typeof e&&(e={}),F=t.extend(F,e),t.each(["onChange","onSelect","onRelease","onDblClick"],function(t,e){"function"!=typeof F[e]&&(F[e]=function(){})})}function h(t,e,i){if(z=r(Y),fe.setCursor("move"===t?t:t+"-resize"),"move"===t)return fe.activateHandlers(u(e),m,i);var n=ue.getFixed(),s=d(t),o=ue.getCorner(d(s));ue.setPressed(ue.getCorner(s)),ue.setCurrent(o),fe.activateHandlers(c(t,n),m,i)}function c(t,e){return function(i){if(F.aspectRatio)switch(t){case"e":i[1]=e.y+1;break;case"w":i[1]=e.y+1;break;case"n":i[0]=e.x+1;break;case"s":i[0]=e.x+1}else switch(t){case"e":i[1]=e.y2;break;case"w":i[1]=e.y2;break;case"n":i[0]=e.x2;break;case"s":i[0]=e.x2}ue.setCurrent(i),pe.update()}}function u(t){var e=t;return ge.watchKeys(),function(t){ue.moveOffset([t[0]-e[0],t[1]-e[1]]),e=t,pe.update()}}function d(t){switch(t){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function p(t){return function(e){return F.disabled?!1:"move"!==t||F.allowMove?(z=r(Y),ne=!0,h(t,a(e)),e.stopPropagation(),e.preventDefault(),!1):!1}}function f(t,e,i){var n=t.width(),s=t.height();n>e&&e>0&&(n=e,s=e/t.width()*t.height()),s>i&&i>0&&(s=i,n=i/t.height()*t.width()),ee=t.width()/n,ie=t.height()/s,t.width(n).height(s)}function g(t){return{x:t.x*ee,y:t.y*ie,x2:t.x2*ee,y2:t.y2*ie,w:t.w*ee,h:t.h*ie}}function m(){var t=ue.getFixed();t.w>F.minSelect[0]&&t.h>F.minSelect[1]?(pe.enableHandles(),pe.done()):pe.release(),fe.setCursor(F.allowSelect?"crosshair":"default")}function v(t){if(F.disabled)return!1;if(!F.allowSelect)return!1;ne=!0,z=r(Y),pe.disableHandles(),fe.setCursor("crosshair");var e=a(t);return ue.setPressed(e),pe.update(),fe.activateHandlers(y,m,"touch"===t.type.substring(0,5)),ge.watchKeys(),t.stopPropagation(),t.preventDefault(),!1}function y(t){ue.setCurrent(t),pe.update()}function b(){var e=t("<div></div>").addClass(s("tracker"));return H&&e.css({opacity:0,backgroundColor:"white"}),e}function x(t){$.removeClass().addClass(s("holder")).addClass(t)}function w(t,e){function i(){window.setTimeout(y,u)}var n=t[0]/ee,s=t[1]/ie,o=t[2]/ee,r=t[3]/ie;if(!se){var a=ue.flipCoords(n,s,o,r),l=ue.getFixed(),h=[l.x,l.y,l.x2,l.y2],c=h,u=F.animationDelay,d=a[0]-h[0],p=a[1]-h[1],f=a[2]-h[2],g=a[3]-h[3],m=0,v=F.swingSpeed;n=c[0],s=c[1],o=c[2],r=c[3],pe.animMode(!0);var y=function(){return function(){m+=(100-m)/v,c[0]=Math.round(n+m/100*d),c[1]=Math.round(s+m/100*p),c[2]=Math.round(o+m/100*f),c[3]=Math.round(r+m/100*g),m>=99.8&&(m=100),100>m?(k(c),i()):(pe.done(),pe.animMode(!1),"function"==typeof e&&e.call(me))}}();i()}}function _(t){k([t[0]/ee,t[1]/ie,t[2]/ee,t[3]/ie]),F.onSelect.call(me,g(ue.getFixed())),pe.enableHandles()}function k(t){ue.setPressed([t[0],t[1]]),ue.setCurrent([t[2],t[3]]),pe.update()}function C(){return g(ue.getFixed())}function T(){return ue.getFixed()}function S(t){l(t),L()}function D(){F.disabled=!0,pe.disableHandles(),pe.setCursor("default"),fe.setCursor("default")}function P(){F.disabled=!1,L()}function A(){pe.done(),fe.activateHandlers(null,null)}function M(){$.remove(),R.show(),R.css("visibility","visible"),t(e).removeData("Jcrop")}function I(t,e){pe.release(),D();var i=new Image;i.onload=function(){var n=i.width,s=i.height,o=F.boxWidth,r=F.boxHeight;Y.width(n).height(s),Y.attr("src",t),U.attr("src",t),f(Y,o,r),X=Y.width(),G=Y.height(),U.width(X).height(G),ae.width(X+2*re).height(G+2*re),$.width(X).height(G),de.resize(X,G),P(),"function"==typeof e&&e.call(me)},i.src=t}function E(t,e,i){var n=e||F.bgColor;F.bgFade&&o()&&F.fadeTime&&!i?t.animate({backgroundColor:n},{queue:!1,duration:F.fadeTime}):t.css("backgroundColor",n)}function L(t){F.allowResize?t?pe.enableOnly():pe.enableHandles():pe.disableHandles(),fe.setCursor(F.allowSelect?"crosshair":"default"),pe.setCursor(F.allowMove?"move":"default"),F.hasOwnProperty("trueSize")&&(ee=F.trueSize[0]/X,ie=F.trueSize[1]/G),F.hasOwnProperty("setSelect")&&(_(F.setSelect),pe.done(),delete F.setSelect),de.refresh(),F.bgColor!=le&&(E(F.shade?de.getShades():$,F.shade?F.shadeColor||F.bgColor:F.bgColor),le=F.bgColor),he!=F.bgOpacity&&(he=F.bgOpacity,F.shade?de.refresh():pe.setBgOpacity(he)),Q=F.maxSize[0]||0,Z=F.maxSize[1]||0,J=F.minSize[0]||0,te=F.minSize[1]||0,F.hasOwnProperty("outerImage")&&(Y.attr("src",F.outerImage),delete F.outerImage),pe.refresh()}var z,F=t.extend({},t.Jcrop.defaults),N=navigator.userAgent.toLowerCase(),H=/msie/.test(N),O=/msie [1-6]\./.test(N);"object"!=typeof e&&(e=t(e)[0]),"object"!=typeof i&&(i={}),l(i);var W={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},R=t(e),B=!0;if("IMG"==e.tagName){if(0!=R[0].width&&0!=R[0].height)R.width(R[0].width),R.height(R[0].height);else{var j=new Image;j.src=R[0].src,R.width(j.width),R.height(j.height)}var Y=R.clone().removeAttr("id").css(W).show();Y.width(R.width()),Y.height(R.height()),R.after(Y).hide()}else Y=R.css(W).show(),B=!1,null===F.shade&&(F.shade=!0);f(Y,F.boxWidth,F.boxHeight);var X=Y.width(),G=Y.height(),$=t("<div />").width(X).height(G).addClass(s("holder")).css({position:"relative",backgroundColor:F.bgColor}).insertAfter(R).append(Y);F.addClass&&$.addClass(F.addClass);var U=t("<div />"),q=t("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),V=t("<div />").width("100%").height("100%").css("zIndex",320),K=t("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var t=ue.getFixed();F.onDblClick.call(me,t)}).insertBefore(Y).append(q,V);B&&(U=t("<img />").attr("src",Y.attr("src")).css(W).width(X).height(G),q.append(U)),O&&K.css({overflowY:"hidden"});var Q,Z,J,te,ee,ie,ne,se,oe,re=F.boundary,ae=b().width(X+2*re).height(G+2*re).css({position:"absolute",top:n(-re),left:n(-re),zIndex:290}).mousedown(v),le=F.bgColor,he=F.bgOpacity;z=r(Y);var ce=function(){function t(){var t,e={},i=["touchstart","touchmove","touchend"],n=document.createElement("div");try{for(t=0;t<i.length;t++){var s=i[t];s="on"+s;var o=s in n;o||(n.setAttribute(s,"return;"),o="function"==typeof n[s]),e[i[t]]=o}return e.touchstart&&e.touchend&&e.touchmove}catch(r){return!1}}function e(){return F.touchSupport===!0||F.touchSupport===!1?F.touchSupport:t()}return{createDragger:function(t){return function(e){return F.disabled?!1:"move"!==t||F.allowMove?(z=r(Y),ne=!0,h(t,a(ce.cfilter(e)),!0),e.stopPropagation(),e.preventDefault(),!1):!1}},newSelection:function(t){return v(ce.cfilter(t))},cfilter:function(t){return t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t},isSupported:t,support:e()}}(),ue=function(){function t(t){t=r(t),f=d=t[0],g=p=t[1]}function e(t){t=r(t),c=t[0]-f,u=t[1]-g,f=t[0],g=t[1]}function i(){return[c,u]}function n(t){var e=t[0],i=t[1];0>d+e&&(e-=e+d),0>p+i&&(i-=i+p),g+i>G&&(i+=G-(g+i)),f+e>X&&(e+=X-(f+e)),d+=e,f+=e,p+=i,g+=i}function s(t){var e=o();switch(t){case"ne":return[e.x2,e.y];case"nw":return[e.x,e.y];case"se":return[e.x2,e.y2];case"sw":return[e.x,e.y2]}}function o(){if(!F.aspectRatio)return l();var t,e,i,n,s=F.aspectRatio,o=F.minSize[0]/ee,r=F.maxSize[0]/ee,c=F.maxSize[1]/ie,u=f-d,m=g-p,v=Math.abs(u),y=Math.abs(m),b=v/y;return 0===r&&(r=10*X),0===c&&(c=10*G),s>b?(e=g,i=y*s,t=0>u?d-i:i+d,0>t?(t=0,n=Math.abs((t-d)/s),e=0>m?p-n:n+p):t>X&&(t=X,n=Math.abs((t-d)/s),e=0>m?p-n:n+p)):(t=f,n=v/s,e=0>m?p-n:p+n,0>e?(e=0,i=Math.abs((e-p)*s),t=0>u?d-i:i+d):e>G&&(e=G,i=Math.abs(e-p)*s,t=0>u?d-i:i+d)),t>d?(o>t-d?t=d+o:t-d>r&&(t=d+r),e=e>p?p+(t-d)/s:p-(t-d)/s):d>t&&(o>d-t?t=d-o:d-t>r&&(t=d-r),e=e>p?p+(d-t)/s:p-(d-t)/s),0>t?(d-=t,t=0):t>X&&(d-=t-X,t=X),0>e?(p-=e,e=0):e>G&&(p-=e-G,e=G),h(a(d,p,t,e))}function r(t){return t[0]<0&&(t[0]=0),t[1]<0&&(t[1]=0),t[0]>X&&(t[0]=X),t[1]>G&&(t[1]=G),[Math.round(t[0]),Math.round(t[1])]}function a(t,e,i,n){var s=t,o=i,r=e,a=n;return t>i&&(s=i,o=t),e>n&&(r=n,a=e),[s,r,o,a]}function l(){var t,e=f-d,i=g-p;return Q&&Math.abs(e)>Q&&(f=e>0?d+Q:d-Q),Z&&Math.abs(i)>Z&&(g=i>0?p+Z:p-Z),te/ie&&Math.abs(i)<te/ie&&(g=i>0?p+te/ie:p-te/ie),J/ee&&Math.abs(e)<J/ee&&(f=e>0?d+J/ee:d-J/ee),0>d&&(f-=d,d-=d),0>p&&(g-=p,p-=p),0>f&&(d-=f,f-=f),0>g&&(p-=g,g-=g),f>X&&(t=f-X,d-=t,f-=t),g>G&&(t=g-G,p-=t,g-=t),d>X&&(t=d-G,g-=t,p-=t),p>G&&(t=p-G,g-=t,p-=t),h(a(d,p,f,g))}function h(t){return{x:t[0],y:t[1],x2:t[2],y2:t[3],w:t[2]-t[0],h:t[3]-t[1]}}var c,u,d=0,p=0,f=0,g=0;return{flipCoords:a,setPressed:t,setCurrent:e,getOffset:i,moveOffset:n,getCorner:s,getFixed:o}}(),de=function(){function e(t,e){f.left.css({height:n(e)}),f.right.css({height:n(e)})}function i(){return s(ue.getFixed())}function s(t){f.top.css({left:n(t.x),width:n(t.w),height:n(t.y)}),f.bottom.css({top:n(t.y2),left:n(t.x),width:n(t.w),height:n(G-t.y2)}),f.right.css({left:n(t.x2),width:n(X-t.x2)}),f.left.css({width:n(t.x)})}function o(){return t("<div />").css({position:"absolute",backgroundColor:F.shadeColor||F.bgColor}).appendTo(p)}function r(){d||(d=!0,p.insertBefore(Y),i(),pe.setBgOpacity(1,0,1),U.hide(),a(F.shadeColor||F.bgColor,1),pe.isAwake()?h(F.bgOpacity,1):h(1,1))}function a(t,e){E(u(),t,e)}function l(){d&&(p.remove(),U.show(),d=!1,pe.isAwake()?pe.setBgOpacity(F.bgOpacity,1,1):(pe.setBgOpacity(1,1,1),pe.disableHandles()),E($,0,1))}function h(t,e){d&&(F.bgFade&&!e?p.animate({opacity:1-t},{queue:!1,duration:F.fadeTime}):p.css({opacity:1-t}))}function c(){F.shade?r():l(),pe.isAwake()&&h(F.bgOpacity)}function u(){return p.children()}var d=!1,p=t("<div />").css({position:"absolute",zIndex:240,opacity:0}),f={top:o(),left:o().height(G),right:o().height(G),bottom:o()};return{update:i,updateRaw:s,getShades:u,setBgColor:a,enable:r,disable:l,resize:e,refresh:c,opacity:h}}(),pe=function(){function e(e){var i=t("<div />").css({position:"absolute",opacity:F.borderOpacity}).addClass(s(e));return q.append(i),i}function i(e,i){var n=t("<div />").mousedown(p(e)).css({cursor:e+"-resize",position:"absolute",zIndex:i}).addClass("ord-"+e);return ce.support&&n.bind("touchstart.jcrop",ce.createDragger(e)),V.append(n),n}function o(t){var e=F.handleSize,n=i(t,D++).css({opacity:F.handleOpacity}).addClass(s("handle"));return e&&n.width(e).height(e),n}function r(t){return i(t,D++).addClass("jcrop-dragbar")}function a(t){var e;for(e=0;e<t.length;e++)M[t[e]]=r(t[e])}function l(t){var i,n;for(n=0;n<t.length;n++){switch(t[n]){case"n":i="hline";break;case"s":i="hline bottom";break;case"e":i="vline right";break;case"w":i="vline"}P[t[n]]=e(i)}}function h(t){var e;for(e=0;e<t.length;e++)A[t[e]]=o(t[e])}function c(t,e){F.shade||U.css({top:n(-e),left:n(-t)}),K.css({top:n(e),left:n(t)})}function u(t,e){K.width(Math.round(t)).height(Math.round(e))}function d(){var t=ue.getFixed();ue.setPressed([t.x,t.y]),ue.setCurrent([t.x2,t.y2]),f()}function f(t){return S?m(t):void 0}function m(t){var e=ue.getFixed();u(e.w,e.h),c(e.x,e.y),F.shade&&de.updateRaw(e),S||y(),t?F.onSelect.call(me,g(e)):F.onChange.call(me,g(e))}function v(t,e,i){(S||e)&&(F.bgFade&&!i?Y.animate({opacity:t},{queue:!1,duration:F.fadeTime}):Y.css("opacity",t))}function y(){K.show(),F.shade?de.opacity(he):v(he,!0),S=!0}function x(){k(),K.hide(),F.shade?de.opacity(1):v(1),S=!1,F.onRelease.call(me)}function w(){I&&V.show()}function _(){return I=!0,F.allowResize?(V.show(),!0):void 0}function k(){I=!1,V.hide()}function C(t){t?(se=!0,k()):(se=!1,_())}function T(){C(!1),d()}var S,D=370,P={},A={},M={},I=!1;F.dragEdges&&t.isArray(F.createDragbars)&&a(F.createDragbars),t.isArray(F.createHandles)&&h(F.createHandles),F.drawBorders&&t.isArray(F.createBorders)&&l(F.createBorders),t(document).bind("touchstart.jcrop-ios",function(e){t(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var E=b().mousedown(p("move")).css({cursor:"move",position:"absolute",zIndex:360});return ce.support&&E.bind("touchstart.jcrop",ce.createDragger("move")),q.append(E),k(),{updateVisible:f,update:m,release:x,refresh:d,isAwake:function(){return S},setCursor:function(t){E.css("cursor",t)},enableHandles:_,enableOnly:function(){I=!0},showHandles:w,disableHandles:k,animMode:C,setBgOpacity:v,done:T}}(),fe=function(){function e(e){ae.css({zIndex:450}),e?t(document).bind("touchmove.jcrop",r).bind("touchend.jcrop",l):d&&t(document).bind("mousemove.jcrop",n).bind("mouseup.jcrop",s)}function i(){ae.css({zIndex:290}),t(document).unbind(".jcrop")}function n(t){return c(a(t)),!1}function s(t){return t.preventDefault(),t.stopPropagation(),ne&&(ne=!1,u(a(t)),pe.isAwake()&&F.onSelect.call(me,g(ue.getFixed())),i(),c=function(){},u=function(){}),!1}function o(t,i,n){return ne=!0,c=t,u=i,e(n),!1}function r(t){return c(a(ce.cfilter(t))),!1}function l(t){return s(ce.cfilter(t))}function h(t){ae.css("cursor",t)}var c=function(){},u=function(){},d=F.trackDocument;return d||ae.mousemove(n).mouseup(s).mouseout(s),Y.before(ae),{activateHandlers:o,setCursor:h}}(),ge=function(){function e(){F.keySupport&&(o.show(),o.focus())}function i(){o.hide()}function n(t,e,i){F.allowMove&&(ue.moveOffset([e,i]),pe.updateVisible(!0)),t.preventDefault(),t.stopPropagation()}function s(t){if(t.ctrlKey||t.metaKey)return!0;oe=t.shiftKey?!0:!1;var e=oe?10:1;switch(t.keyCode){case 37:n(t,-e,0);break;case 39:n(t,e,0);break;case 38:n(t,0,-e);break;case 40:n(t,0,e);break;case 27:F.allowSelect&&pe.release();break;case 9:return!0}return!1}var o=t('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),r=t("<div />").css({position:"absolute",overflow:"hidden"}).append(o);return F.keySupport&&(o.keydown(s).blur(i),O||!F.fixedSupport?(o.css({position:"absolute",left:"-20px"}),r.append(o).insertBefore(Y)):o.insertBefore(Y)),{watchKeys:e}}();ce.support&&ae.bind("touchstart.jcrop",ce.newSelection),V.hide(),L(!0);var me={setImage:I,animateTo:w,setSelect:_,setOptions:S,tellSelect:C,tellScaled:T,setClass:x,disable:D,enable:P,cancel:A,release:pe.release,destroy:M,focus:ge.watchKeys,getBounds:function(){return[X*ee,G*ie]},getWidgetSize:function(){return[X,G]},getScaleFactor:function(){return[ee,ie]},getOptions:function(){return F},ui:{holder:$,selection:K}};return H&&$.bind("selectstart",function(){return!1}),R.data("Jcrop",me),me},t.fn.Jcrop=function(e,i){var n;return this.each(function(){if(t(this).data("Jcrop")){if("api"===e)return t(this).data("Jcrop");t(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?t.Jcrop.Loader(this,function(){t(this).css({display:"block",visibility:"hidden"}),n=t.Jcrop(this,e),t.isFunction(i)&&i.call(n)}):(t(this).css({display:"block",visibility:"hidden"}),n=t.Jcrop(this,e),t.isFunction(i)&&i.call(n))}),this},t.Jcrop.Loader=function(e,i,n){function s(){r.complete?(o.unbind(".jcloader"),t.isFunction(i)&&i.call(r)):window.setTimeout(s,50)}var o=t(e),r=o[0];o.bind("load.jcloader",s).bind("error.jcloader",function(){o.unbind(".jcloader"),t.isFunction(n)&&n.call(r)}),r.complete&&t.isFunction(i)&&(o.unbind(".jcloader"),i.call(r))},t.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);